{% extends "base.html" %}

{% block title %}Documentation | monitor404{% endblock %}

{% block content %}

<link rel="stylesheet" href="{{ STATIC_URL }}css/monokai_sublime.css"/>
<script src="{{ STATIC_URL }}js/highlight.pack.js"></script>
    
<div class="row">

    <aside class="hide-for-small medium-3 large-2 column">
        <h5>Contents</h5>
        <ul class="side-nav">
            <li><a href="#">Getting Started</a></li>
            <li><a href="#">Settings</a></li>
            <li><a href="#">FAQ</a></li>
            <li><a href="#">Troubleshooting</a></li>
            <li><a href="#">Support</a></li>
        </ul>
    </aside>


    <div class="primary small-12 medium-9 large-10 column">

        <h1>Documentation</h1>
        <hr/>

        <h2>Getting Started</h2>
        <p>
            There are three steps to setting up your site with monitor404:
            <ol>
                <li><a href="{% url 'site_add' %}">Add your site</a> to the monitor404 dashboard.</li>
                <li>Include the script on the pages you want to monitor.</li>
                <li>Configure which links on pages you want to be monitor. (optional &ndash; all are monitored by default.)</li>
            </ol>
        </p>
        <h3>Adding a site</h3>
        <p>To add a site, go to the <a href="{% url 'site_add' %}">&ldquo;Add Site&rdquo; dialog</a> and enter the domain name of your site.</p>
        <p>Note that your site name should include a subdomain if it has one. For example, if your site is on www.reddit.com, include the &ldquo;www&rdquo;. The domain name you enter should be equal to the output of running <code>window.location.host</code> in JavaScript on your site.</p>
        <h3>Including the script</h3>
        <p>To monitor links on a page, include the following script anywhere on the page:</p> 
        <pre><code>&lt;script src="http://monitor404.s3.amazonaws.com/monitor404.min.js"&gt;&lt;/script&gt;</pre></code>
        <p>The script requires <a href="http://jquery.com/">jQuery</a>, which you should also load somewhere on the page. It's tested with jQuery version 1.10.2 but will probably work with other versions.</p>
        <p>That's it! monitor404 will check all links on which a user clicks for 404 errors. It will log errors in the <a href="{% url 'log' %}">dashboard</a> and, by default, send you an email if it finds a broken link. If you only want to monitor certain kinds of links, refer to the next section.</p>

        <h2>Settings</h2>
        <p>monitor404 lets you customize which links it monitors using jQuery selectors and same-origin/different-origin rules. By default, monitor404 will check all links for 404 errors. However in certain cases, you may only wish to check a subset.</p>
        <p>For example, you may already have logging or notifications set up on your server for HTTP 404 errors and only want to monitor links that go to external websites for errors. Or, you may run a blog and want to make sure all links in your posts stay working, but not really care if links in user-submitted comments break.</p>
        <p>To change any of these settings, define a JavaScript object variable on <code>window</code> named <code>_404_SETTINGS</code> anywhere before <code>$(document).ready()</code> fires. (Note the leading underscore on the variable name because JavaScript doesn't allow variables to start with a numeral.)
        <p>Below is an example configuration using all settings, after which each setting is described in detail.</p>
        <pre><code>window._404_SETTINGS = {
    include: 'article a.ref', // only include links inside the &lt;article&gt; 
                              // element that have the class "ref"
    exclude: '.comments a', // exclude links in that are inside an element 
                            // with the class "comments"
    origin: 'different' // only monitor links that go to external sites
};</pre></code>
        <h3><code>include</code></h3>
        <div class="setting panel">
            <strong>Default:</strong> <code>'a'</code> (all links)<br/>
            <strong>Format:</strong> string for a jQuery selector<br/>
            <strong>Constraints:</strong> must select <code>&lt;a&gt;</code> elements only
        </div>
        <p><code>include</code> controls which links are monitored for 404 errors. If not defined, all links will be monitored. If defined, any selector you would use in jQuery (i.e. put inside a <code>$()</code>) is valid, as long as it selects link elements only. Trying to monitor links on non-link elements would be pointless, and it results in a JavaScript error.</p>

        <h3><code>exclude</code></h3>
        <div class="setting panel">
            <strong>Default:</strong> <code>''</code> (no links)<br/>
            <strong>Format:</strong> string for a jQuery selector<br/>
            <strong>Constraints:</strong> none
        </div>
        <p>From the links that are included, <code>exclude</code> determines which to omit from monitoring. No links are excluded by default. As with <code>include</code>, any jQuery selector is valid.</p>

        <h3><code>origin</code></h3>
        <div class="setting panel">
            <strong>Default:</strong> <code>'both'</code> (&ldquo;internal&rdquo; and &ldquo;external&rdquo; links)<br/>
            <strong>Options:</strong> <code>'same'</code>, <code>'different'</code>, or <code>'both'</code><br/>
        </div>
        <p><code>origin</code> allows you to include/exclude links for monitoring based on whether they are internal or external; i.e. whether they link to another page on your site and have the <code>'same'</code> hostname as the page from which they originate, or to a page off your site and have a <code>'different'</code> hostname than the page from which they originate. By default, both types are monitored.

        <h2>FAQ</h2>
        <h3>I set everything up; how do I know if it's working?</h3>
        <p><strong>Short answer:</strong> control-click/Apple-click a link to open it in a new tab, check the Network panel in Chrome (or equivalent in other browsers), make sure the response is a happy success message.</p>
        <p><strong>Longer answer:</strong> see the &ldquo;Troubleshooting&rdquo; section below.</p>
        
        <h3>How does monitor404 work?</h3>
        <p>When you set up monitor404, you include a tiny JavaScript file on the page. Whenever a user clicks a link that's being monitored, this JavaScript sends an Ajax request to a monitor404 server with the link they're trying to visit in the split second before they leave the page. monitor404 puts that link into an asyncronous processing queue, and then issues the URL a HEAD request to check the status code of the response.</p>

        <h3>Won't that Ajax request slow things down?</h3>
        <p>Yes, but not perceptibly. The request/response is so quick that it's virtually unnoticable, even if you're looking for it.</p>

        <h3>So every time a user clicks on a link, it's double the requests?</h3>
        <p>No, for two reasons:
        <ol>
            <li>monitor404 caches the result of a URL check for an hour, so heavily trafficked links don't get re-checked with every click.</li>
            <li>monitor404 only issues HEAD requests, which are significantly lighter than GET requests because they only return the HTTP headers and not the body content of the page.</li>
        </ol></p>

        <h3>What happens if your server goes down?</h3>
        <p>monitor404 has graceful fallback measures in place to make sure all links work as normal if (heaven forbid) our server malfunctioned or went down.</p>

        <h2>Troubleshooting</h2>
        <p>Setting up monitor404 is quite straightforward, but things always have a tendency to go awry, don't they? The purpose of this section is to make troubleshooting any errors as painless as possible.</p>
        <h3>Getting Feedback</h3>
        <p>For every link check that monitor404 sends out, it returns a JSON response that contains some useful information.</p>
        <p>To see this response, open the Chrome Developer Tools (I highly recommend Chrome though other major browsers have similiar solutions) and go to the &ldquo;Network&rdquo; tab.</p>
        <p>If you click on a link normally, the new page will load before you can see the response from monitor404. To mitigate this, simply <kbd>control+click</kbd> (or <kbd>Apple+click</kbd>, depending on your OS) on the link so that it opens in a new tab. In the &ldquo;Network&rdquo; panel on the first page, you should see a request to <samp>monitor404.com/api/check/</samp>.</p>
        <p>If everything went well, you should see something like:</p>
        <pre><code>{result: 0, status: "success", message="Link queued for check."}</pre></code>
        <p>If something went wrong, you may see something like:</p>
        <pre><code>{result: 1, error: "DoesNotExist", 
message: "UserSite matching host \"example.com\" was not found."}</pre></code>

        <h2>Support</h2>
        <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.</p>
        <pre><code>
&lt;script src="http://monitor404.s3.amazonaws.com/monitor404.min.js"&gt;&lt;/script&gt;
        </pre></code>
        <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.</p>

    </div>
</div>

{% endblock %}
